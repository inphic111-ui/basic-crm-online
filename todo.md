# CRM 3.0 開發進度追蹤

## 已完成功能

### 基礎框架（第一至十一階段）
- [x] 客戶資料管理頁面基本框架
- [x] 客戶列表顯示
- [x] 客戶編輯功能
- [x] 客戶刪除功能
- [x] N/F/V/P 評分系統
- [x] 客戶類型自動分類
- [x] UI 細部調整

### 數據修復與優化（第十二至二十一階段）
- [x] V 評分連動修復
- [x] N/F 評分選項描述
- [x] 年度消費額顯示修復（使用 PostgreSQL CAST）
- [x] 訂單狀態選項更新（新增「未處理」，改「不買」為「流失」）
- [x] 代碼瘦身（移除 console.log 和未使用的函數）

## Bug 修複

### UI 修複 Bug
- [x] 修複：電話欄位仍然顯示
- [x] 修複：詳情視窗商品超連結未顯示
- [x] 修複：音檔上傳標籤亂碼
- [x] 修複：詳情視窗音檔和 AI 分析未顯示
- [x] 修複：商品超連結貼上但沒有保存到數據庫

## 新增需求

### 商品網址功能
- [x] 在客戶詳情表格中添加商品網址欄位
- [x] 商品網址顯示為可點擊的超連結
- [x] 沒有網址時顯示为"-"

### UI 修改需求
- [x] 取消联繫資訊區塊
- [x] 評級備註 Tooltip 功能（滑鼠懸停時顯示備註）
- [ ] 評估成交狀態的替代字詞
- [x] 產品字段改为詢問產品
- [x] 編輯區新增商品超連結欄位
- [x] 詢問產品管理頁可點擊超連結進入商品頁
- [x] 彈出視窗音檔區區仅顯示音檔圖示（喇叭），點擊播放
- [x] 彈出視窗隐藏音檔上傳按鈕
- [x] 彈出視窗新增 AI 分析欄位

## 當前需要修復的問題

### AI analysis 欄位修複
- [x] 修複 PostgreSQL UI 中的語法錯誤（欄位名稱包含空格）
- [x] 確保 ai_analysis 欄位在前端可正常顯示和編輯

### 商品網址功能調整
- [x] 移除表格中的「商品網址」欄位
- [x] 在「詢問商品」欄位上添加點擊功能
- [x] 點擊「詢問商品」時跳轉到商品網址
- [x] 修複商品網址保存後不顯示的問題

## 進行中的功能開發

### 搜尋功能（第二十二階段）
- [ ] 實現搜尋欄（客戶編號/名稱）
- [ ] 實現狀態下拉選單（未處理、追單、成交、售後、流失）
- [ ] 實現負責人下拉選單（隨機生成人名）
- [ ] 測試搜尋功能
- [ ] 推送到 GitHub 並驗證 Railway 部署

### 音檔上傳（第二十三階段）
- [ ] 實現音檔上傳按鈕
- [ ] 實現音檔上傳功能
- [ ] 在客戶詳情中顯示音檔播放按鈕（喇叭 emoji）
- [ ] 實現音檔播放功能
- [ ] 測試音檔上傳功能
- [ ] 推送到 GitHub 並驗證 Railway 部署

### 音檔上傳、轉錄和分析（第二十四階段）
- [ ] 實現音檔上傳 UI（在客戶詳情中）
- [ ] 實現音檔上傳後端 API
- [ ] 集成 Whisper API 進行音檔轉錄
- [ ] 集成 AI 分析給出客戶建議
- [ ] 測試音檔功能
- [ ] 推送到 GitHub 並驗證 Railway 部署

### 訂單管理與購買歷史（第二十五階段）
- [ ] 設計訂單表結構
- [ ] 創建訂單表遷移
- [ ] 實現訂單列表頁面
- [ ] 實現訂單狀態管理
- [ ] 實現訂單成交和確認收款功能
- [ ] 在客戶詳情中顯示購買歷史
- [ ] 實現購買歷史詳情彈窗

## 技術細節

### 數據庫架構
- 客戶表：customers
- 訂單表：orders（待建立）
- 音檔表：audio_files（待建立）

### 後端 API
- GET /api/customers - 獲取客戶列表（支援搜尋和篩選）
- GET /api/customers/:id - 獲取客戶詳情
- PUT /api/customers/:id - 更新客戶信息
- DELETE /api/customers/:id - 刪除客戶
- POST /api/audio - 上傳音檔
- POST /api/ai/analyze - AI 分析音檔

### 前端頁面
- 客戶清單（支援搜尋和篩選）
- 客戶詳情彈窗（顯示購買歷史、音檔、AI 分析）
- 錄音管理頁面（待建立）
- 訂單列表頁面（待建立）

### 彈出視窗顯示問題修複
- [x] 修複 N 評分和 F 評分在彈出視窗中不顯示的問題
- [x] 移除彈出視窗中的商品超連結顯示（保留表格中的顯示）

### N 評分和 F 評分只讀模式顯示修複
- [x] 檢查數據庫中 nfvp_score_n 和 nfvp_score_f 的數據
- [x] 修改只讀模式下 N 評分和 F 評分的顯示邏輯，顯示選項描述而不是「-」
- [x] 確保編輯後保存的值能正確顯示

### N 評分和 F 評分保存問題修復
- [ ] 檢查後端 API 是否正確處理 nfvp_score_n 和 nfvp_score_f
- [ ] 確保前端正確發送這兩個欄位的值
- [ ] 修復編輯後保存不顯示的問題

## 下一階段功能開發（第二十六階段）

### 表格優化
- [x] 刪除表格中的「商品網址」欄位
- [x] 確保「詢問產品」欄位已包含超連結功能

### 英打功能（語音轉文字）
- [ ] 在客戶詳情中添加「英打」欄位
- [ ] 實現音檔上傳功能
- [ ] 集成 Whisper API 進行語音轉錄
- [ ] 顯示轉錄結果並允許編輯

### AI 分析功能
- [x] 在客戶詳情中添加「AI 分析」欄位
- [x] 實現「生成 AI 分析」按鈕
- [x] 調用 OpenAI API 根據客戶信息生成分析
- [x] 顯示分析結果並允許編輯
- [x] 補充回頭客指標（資本額、年度消費、總消費、音檔）到 AI 分析
- [x] 如果沒有上傳音檔，在分析結果下方提示用戶上傳
- [x] 升級 OpenAI 模型從 GPT-3.5 到 GPT-4o

### 成交狀態優化
- [ ] 評估「成交」狀態是否需要改名（如「首次成交」）
- [ ] 設計一次成交 → 二次銷售的流程定義
- [ ] 添加「銷售階段」或「客戶生命週期」欄位
- [ ] 實現狀態轉換邏輯

### 二次銷售流程
- [ ] 定義二次銷售的觸發條件
- [ ] 設計二次銷售的狀態流轉
- [ ] 在客戶詳情中顯示購買歷史
- [ ] 實現二次銷售的追蹤機制
