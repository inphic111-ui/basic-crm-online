# 基本 CRM 系統 - 開發任務清單

## 已完成功能

### 戰情室（銷售暫停式）
- [x] 上方四個統計卡片（總客戶數、新客、回購客、常客）
- [x] 下方四個指標卡片（平均訂單金額、本月銷售額、平均回覆時間、平均成交周期）
- [x] 卡片對齐和字體大小統一
- [x] 購買階段分佈圖表
- [x] 其他圖表和分析

### 任務戰情室
- [x] 左側功能欄區隔（戰情室 / 任務）
- [x] 任務統計卡片（總任務數、待辦、進行中、完成率）
- [x] 任務圖表（完成趨勢、優先級分佈、狀態分佈）

### 客戶資料管理 - 核心功能
- [x] 建立客戶資料資料庫表結構（17 個欄位）
- [x] 建立客戶資料後端 API（CRUD 操作）
  - [x] GET /api/customers（獲取客戶列表）
  - [x] GET /api/customers/:id（獲取單個客戶詳細信息）
  - [x] POST /api/customers（創建客戶）
  - [x] PUT /api/customers/:id（更新客戶）
  - [x] DELETE /api/customers/:id（刪除客戶）
  - [x] POST /api/customers/init-table（初始化表）
- [x] 建立客戶資料前端列表視圖
  - [x] 13 個欄位的表格顯示
  - [x] 客戶分類圖標（鯊魚/鯨魚/草魚/蝦）
  - [x] 評級徽章（S/A/B/C/D/E）
  - [x] 訂單狀態標籤
- [x] 建立客戶資料詳細視窗
  - [x] 點擊客戶編號打開視窗
  - [x] 顯示全部 17 個欄位
  - [x] 刪除功能
  - [x] 關閉功能
- [x] 建立新增客戶表單
  - [x] 17 個欄位的表單輸入
  - [x] 表單驗證（必填項檢查）
  - [x] 保存功能

## 完成的功能

### 客戶資料管理 - UI 微調（第二階段）
- [x] 修改表格操作按鈕：「查看」→「編輯」，「刪除客戶」→「儲存」
- [x] 統一詳細視窗文本：「信息」→「資訊」
- [x] 實現評分資訊的下拉選擇：NFVP/評級/客戶類型
- [x] 實現交易資訊的下拉選擇：訂單狀態/來源
- [x] 設置 CVI 評分為唯讀（自動計算）
- [x] 根據 LOL Season 13 牌位設計評級顏色
- [x] 測試所有下拉選擇功能
- [x] 驗證數據保存功能
- [x] 擴展 PUT API 端點以支持所有客戶字段的更新

## 進行中功能

### 客戶資料管理 - UI 細部調整（第四階段）
- [x] 修改標題：「基本信息」→「基本資訊」、「評分信息」→「評分資訊」、「交易信息」→「交易資訊」、「聯繫信息」→「聯繫資訊"
- [x] 實現基本資訊字段可編輯（客戶編號、客戶名稱、公司名稱、資本額）
- [x] 修改 NFVP 為 4 個獨立下拉選擇（N/F/V/P 評分，每個 0/2/4/6/8/10）
- [x] 實現客戶編號只讀視窗（點擊客戶編號打開，只有右上角 X，無儲存/取消按鈕）
- [x] 調整評級選項為 6 個有文字的等級（S-Challenger/A-Diamond/B-Platinum/C-Gold/D-Silver/E-Bronze）
- [x] 移除重複的 PUT API 端點，確保只有一個正確的實現
- [x] 測試所有修改
- [x] 推送到 GitHub 並驗證 Railway 部署

### 客戶資料管理 - 高級功能
- [ ] 搜尋功能
- [ ] 篩選功能
- [ ] 分頁功能
- [ ] 編輯客戶功能
- [ ] CSV 導入功能

## 待實現功能

### CSV 導入功能
- [ ] 設計 CSV 導入流程
- [ ] 實現壓縮檔解壓功能
- [ ] 實現 CSV 解析功能
- [ ] 實現批量導入 API
- [ ] 實現導入驗證和錯誤處理
- [ ] 實現重複檢測

### 客戶分類和評分
- [ ] 實現 CVI 評分自動計算
- [ ] 實現客戶屬性自動分類（鯊魚/鯨魚/草魚/蝦）
- [ ] 實現建議行動自動生成

### 其他功能
- [ ] 錄音管理
- [ ] 知識庫
- [ ] 使用者管理
- [ ] 部署到 Railway

### 客戶資料管理 - UI 佈局修複（第五階段）
- [x] 恢復客戶類型下拉選單，放在評級下方
- [x] 修複 CVI 分數為唯讀顯示（自動計算，不可編輯）
- [x] 調整評分資訊佈局，避免「瓶」字覆蓋 CVI 分數
- [x] 重新排列字段位置：N/F/V/P 評分、CVI 分數、客戶評級、客戶類型
- [x] 測試所有修複
- [x] 推送到 GitHub 並驗證 Railway 部署

### 客戶資料管理 - CVI 評分顯示邏輯修改（第六階段）
- [ ] 修改 CVI 評分只在只讀視窗中顯示（客戶編號點進來）
- [ ] 在編輯視窗中隱藏 CVI 評分（因為是根據 NFVP 自動計算）
- [x] 測試修改
- [x] 推送到 GitHub 並驗證 Railway 部署

### 客戶資料管理 - 評分資訊佈局調整（第七階段）
- [ ] 將客戶類型移到客戶評級的右列（同一行）
- [ ] 確保 CVI 評分僅在只讀模式下顯示
- [x] 測試修改
- [x] 推送到 GitHub 並驗證 Railway 部署

### 客戶資料管理 - 粀化評分資訊（第八階段）
- [x] 移除 V 評分字段（報價自動轉成分數）
- [x] 移除 P 評分字段（報價自動轉成分數）
- [x] 確認只保留 N 和 F 評分
- [x] 測試修u6539
- [x] 推送到 GitHub 並驗證 Railway 部署
### 客戶資料管理 - 自動計算功能實現（第九階段）
- [ ] 實現 V 評分自動計算函數（根據年採購量：0/2/4/6/8/10）
- [ ] 實現 P 評分自動計算函數（根據單筆採購價格：0/2/4/6/8/10）
- [ ] 實現客戶類型自動判斷函數（根據 V 和 P 組合判斷：鯊魚/鯨魚/草魚/小蝦）
- [ ] 在編輯表單中添加 V 和 P 的顯示字段（唯讀，自動計算）
- [ ] 在編輯表單中添加客戶類型的顯示字段（唯讀，自動判斷）
- [ ] 測試所有自動計算功能
- [x] 推送到 GitHub 並驗證 Railway 部署

### 客戶資料管理 - 自動計算函數邊界規則調整（第十阶段）
- [x] 修改 calculateVScore 函數：根據新的邊界規則（包含下限，不包含上限）
  - V = 10：採購量 ≥ 100 萬
  - V = 8：50 萬 ≤ 採購量 < 100 萬
  - V = 6：30 萬 ≤ 採購量 < 50 萬
  - V = 4：10 萬 ≤ 採購量 < 30 萬
  - V = 2：0 < 採購量 < 10 萬
  - V = 0：採購量 = 0
- [x] 修改 calculatePScore 函數：根據新的邊界規則
  - P = 10：報價 ≥ 10 萬
  - P = 8：5 萬 ≤ 報價 < 10 萬
  - P = 6：3 萬 ≤ 報價 < 5 萬
  - P = 4：1 萬 ≤ 報價 < 3 萬
  - P = 2：0 < 報價 < 1 萬
  - P = 0：報價 = 0
- [x] 將「價格」改爲「報價」（在交易資訊部分）
- [x] 將「P 評分 (採購價格)」改爲「P 評分 (報價額)」（在自動計算資訊部分）
- [x] 完善默認值處理：如果沒有輸入或顯示，就顯示爲 0
- [x] 測試所有修改
- [x] 推送到 GitHub 並驗證 Railway 部署

### 客戶資料管理 - UI 細部調整（第十一階段）
- [x] 移除上方「評分資訊」區塊中的客戶類型下拉選擇（因為下方自動計算資訊已顯示）
- [x] 修正客戶類型標籤：「蝦客戶」→「小蝦客戶」
- [x] 確保 V 評分與採購量（預算）連動計算
- [x] 調整評分資訊佈局順序：
  - N評分(左) F評分(右)
  - V評分(左) P評分(右)
  - CVI分數(左) 客戶類型(右)
  - 客戶評級(左)
- [x] 測試所有修改
- [x] 推送到 GitHub 並驗證 Railway 部署

### 客戶資料管理 - V 評分連動修復（第十二階段）
- [x] 檢查 V 評分計算邏輯，確認是否正確使用 budget
- [x] 修復 V 評分在編輯時的實時更新問題
- [x] 驗證預算修改時 V 評分是否自動更新
- [x] 驗證報價修改時 P 評分是否自動更新
- [x] 測試修改
- [x] 推送到 GitHub 並驗證 Railway 部署

### 客戶資料管理 - V 評分連動調試（第十三階段）
- [ ] 調試 V 評分連動問題：P 評分有連動但 V 評分沒有
- [ ] 確認 handleEditFormChange 是否正確更新 editFormData.budget
- [ ] 確認 calculateVScore 函數是否正確計算
- [ ] 檢查是否需要強制刷新前端頁面（清除緩存）
- [ ] 驗證 Railway 部署是否已完成
- [ ] 測試修改
- [ ] 推送到 GitHub 並驗證 Railway 部署


### 客戶資料管理 - V 評分計算基礎修改（第十四階段）
- [x] 修改 V 評分計算基礎：從預算改為報價
- [x] 確認 V 評分和 P 評分都基於報價金額計算
- [x] 測試修改
- [x] 推送到 GitHub 並驗證 Railway 部署


### 客戶資料管理 - N/F 評分選項描述（第十五階段）
- [x] 為 N 評分選項添加精簡描述文字（10 個等級）
- [x] 為 F 評分選項添加精簡描述文字（10 個等級）
- [x] 測試修改
- [x] 推送到 GitHub 並驗證 Railway 部署

### 客戶資料管理 - 關鍵問題修復（第十六階段）
- [x] 修復年度消費額顯示「NT$非數值」問題
  - [x] 在後端 GET /api/customers 端點中添加 annual_consumption 欄位
  - [x] 前端已有正確的 NULL 值處理
- [x] 修復修改報價後客戶類型沒有自動更新問題
  - [x] 修改表格顯示邏輯，使用保存的 customer_type 字段
  - [x] 驗證前端正確傳遞 customer_type 值
  - [x] 在後端 PUT API 中添加新的支持字段
  - [x] 删除重複的 GET /api/customers 端點
  - [x] 測試修改
  - [x] 推送到 GitHub 並驗證 Railway 部署

### 客戶資料管理 - N/F 評分欄位修復（第十八階段）
- [ ] 在 Railway PostgreSQL 中添加 nfvp_score_n 欄位
- [ ] 在 Railway PostgreSQL 中添加 nfvp_score_f 欄位
- [ ] 驗證欄位添加成功
- [ ] 前端重新保存 N/F 評分並驗證成功

### 客戶資料管理 - 訂單狀態選項更新（第十九階段）
- [x] 修復「售後」選項標籤（從日文「売後」改回中文「售後」）
- [x] 在前端下拉菜單中新增「未處理」選項
- [x] 在 ORDER_STATUS_CONFIG 中定義「未處理」的顏色
- [x] 將「不買」改為「流失」
- [x] 前端代碼已構建並推送到 GitHub（提交：27702ac）
- [ ] 驗證 Railway 部署完成
- [ ] 在 Railway 數據庫中更新現有的「不買」為「流失」
- [ ] 測試修改

### 客戶資料管理 - 年度消費欄位修複（第二十階段）
- [x] 診斷年度消費欄位顯示「NT$非數値」的問題
- [x] 檢查後端 GET API 返回的 annual_consumption 數據
- [x] 檢查 PostgreSQL 中 annual_consumption 欄位的數據類型和值
- [x] 修複後端數據轉換邏輯
- [x] 修複前端顯示邏輯
- [x] 測試修改
- [ ] 推送到 GitHub 並驗證 Railway 部署
