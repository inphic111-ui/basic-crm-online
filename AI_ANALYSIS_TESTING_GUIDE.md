# AI å®¢æˆ¶åˆ†æåŠŸèƒ½æ¸¬è©¦æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°

æœ¬ç³»çµ±å·²æ•´åˆ **Gemini AI å®¢æˆ¶åˆ†æåŠŸèƒ½**ï¼Œå¯ä»¥å¾ LINE CSV å°è©±è¨˜éŒ„è‡ªå‹•ç”Ÿæˆå®Œæ•´çš„æ¶ˆè²»è€…è¼ªå»“ï¼ŒåŒ…æ‹¬ï¼š

- **é›·é”åœ– 6 å€‹ç¶­åº¦åˆ†æ•¸**ï¼ˆ0-100ï¼‰
- **éŠ·å”®åˆ†æå’Œå»ºè­°ç­–ç•¥**
- **è©³ç´°åˆ†æå ±å‘Š**ï¼ˆMarkdown æ ¼å¼ï¼‰
- **å®¢æˆ¶è³‡è¨Šè‡ªå‹•æå–**
- **ç”¢å“è³‡è¨Šè‡ªå‹•æå–**
- **å ±åƒ¹è³‡è¨Šè‡ªå‹•æå–**
- **æ±ºç­–çµæ§‹åˆ†æ**

## æ¸¬è©¦æµç¨‹

### 1. ä¸Šå‚³ CSV æª”æ¡ˆ

ä½¿ç”¨å®¢æˆ¶åˆ—è¡¨é é¢å³ä¸Šè§’çš„ã€Œä¸Šå‚³ CSVã€æŒ‰éˆ•ï¼ˆåƒ…ç®¡ç†å“¡å¯è¦‹ï¼‰ä¸Šå‚³ LINE å°è©±è¨˜éŒ„ CSV æª”æ¡ˆã€‚

**æª”æ¡ˆåç¨±æ ¼å¼**ï¼š
```
U12345678_å®¢æˆ¶åç¨±_ç”¢å“åç¨±.csv
```

**CSV å…§å®¹æ ¼å¼**ï¼š
```csv
Date,Type,User senderName,Message
2024-01-15 10:30,User,æ½˜å°å§_AIè»Ÿä»¶,ä½ å¥½ï¼Œæˆ‘æƒ³äº†è§£ä¸€ä¸‹ä½ å€‘çš„ AI è»Ÿä»¶
2024-01-15 10:31,Admin,æ¥­å‹™å“¡,æ‚¨å¥½ï¼æˆ‘å€‘çš„ AI è»Ÿä»¶...
```

### 2. æª¢æŸ¥ä¸Šå‚³çµæœ

ä¸Šå‚³æˆåŠŸå¾Œï¼Œç³»çµ±æœƒé¡¯ç¤ºï¼š
- âœ… ç¸½è¨˜éŒ„æ•¸
- âœ… æ–°å¢è¨˜éŒ„æ•¸
- âœ… é‡è¤‡è¨˜éŒ„æ•¸ï¼ˆSHA-256 å»é‡ï¼‰
- âœ… ç½é ­è¨Šæ¯æ•¸ï¼ˆå·²éæ¿¾ï¼‰

### 3. ç­‰å¾… AI åˆ†æå®Œæˆ

**AI åˆ†ææ˜¯ç•°æ­¥åŸ·è¡Œçš„**ï¼Œä¸æœƒé˜»å¡ä¸Šå‚³å›æ‡‰ã€‚åˆ†æéç¨‹ï¼š

1. **ç‹€æ…‹è®Šæ›´**ï¼š`pending` â†’ `processing` â†’ `completed`
2. **åˆ†ææ™‚é–“**ï¼šç´„ 10-30 ç§’ï¼ˆå–æ±ºæ–¼å°è©±é•·åº¦ï¼‰
3. **æ—¥èªŒè¨˜éŒ„**ï¼šæ‰€æœ‰æ­¥é©Ÿéƒ½æœƒè¨˜éŒ„åœ¨ `/tmp/crm-server.log`

### 4. æŸ¥çœ‹åˆ†æçµæœ

#### æ–¹æ³• 1ï¼šæŸ¥è©¢è³‡æ–™åº«

```sql
SELECT 
  customer_id,
  customer_name,
  product_name,
  radar_purchase_intention,
  radar_budget_capacity,
  radar_decision_urgency,
  radar_trust_level,
  radar_communication_quality,
  radar_repeat_potential,
  ai_analysis_status,
  ai_analysis_date
FROM ci_customers
WHERE customer_id = 'U12345678';
```

#### æ–¹æ³• 2ï¼šæŸ¥çœ‹è©³ç´°å ±å‘Š

```sql
SELECT 
  customer_id,
  customer_name,
  detailed_report,
  sales_analysis,
  decision_structure
FROM ci_customers
WHERE customer_id = 'U12345678';
```

#### æ–¹æ³• 3ï¼šæŸ¥çœ‹æºé€šæ™‚é–“è»¸

```sql
SELECT 
  customer_id,
  customer_name,
  communication_timeline
FROM ci_customers
WHERE customer_id = 'U12345678';
```

### 5. æª¢æŸ¥æ—¥èªŒ

æŸ¥çœ‹ AI åˆ†ææ—¥èªŒï¼š

```bash
tail -f /tmp/crm-server.log | grep "AI"
```

é æœŸæ—¥èªŒè¼¸å‡ºï¼š
```
[info] ğŸ¤– é–‹å§‹ç”Ÿæˆ AI å®¢æˆ¶åˆ†æ... { customerId: 'U12345678', customerName: 'æ½˜å°å§' }
[info] âœ… AI å®¢æˆ¶åˆ†æå®Œæˆ { customerId: 'U12345678', radarScores: {...}, closingProbability: 75 }
```

## è³‡æ–™åº«æ¬„ä½èªªæ˜

### é›·é”åœ–åˆ†æ•¸ï¼ˆINTEGERï¼Œ0-100ï¼‰

| æ¬„ä½åç¨± | èªªæ˜ | è©•åˆ†æ¨™æº– |
|---------|------|---------|
| `radar_purchase_intention` | è³¼è²·æ„é¡˜ | å®¢æˆ¶è¡¨é”çš„è³¼è²·èˆˆè¶£å’Œæ„åœ– |
| `radar_budget_capacity` | é ç®—èƒ½åŠ› | å®¢æˆ¶çš„é ç®—ç¯„åœå’Œæ”¯ä»˜èƒ½åŠ› |
| `radar_decision_urgency` | æ±ºç­–æ€¥è¿«æ€§ | å®¢æˆ¶åšå‡ºæ±ºç­–çš„æ™‚é–“å£“åŠ› |
| `radar_trust_level` | ä¿¡ä»»ç¨‹åº¦ | å®¢æˆ¶å°ç”¢å“å’Œæ¥­å‹™å“¡çš„ä¿¡ä»» |
| `radar_communication_quality` | æºé€šå“è³ª | å°è©±çš„æ·±åº¦å’Œæœ‰æ•ˆæ€§ |
| `radar_repeat_potential` | å›è³¼æ½›åŠ› | æœªä¾†é‡è¤‡è³¼è²·çš„å¯èƒ½æ€§ |

### éŠ·å”®åˆ†æï¼ˆJSONBï¼‰

```json
{
  "closing_probability": 75,
  "key_concerns": ["åƒ¹æ ¼", "å¯¦æ–½æ™‚é–“"],
  "strengths": ["ç”¢å“ç¬¦åˆéœ€æ±‚", "å®¢æˆ¶é ç®—å……è¶³"],
  "weaknesses": ["ç«¶çˆ­å°æ‰‹å ±åƒ¹æ›´ä½"],
  "recommended_strategy": "å¼·èª¿ç”¢å“çš„é•·æœŸåƒ¹å€¼å’Œå”®å¾Œæœå‹™...",
  "next_steps": ["æä¾›è©³ç´°å ±åƒ¹å–®", "å®‰æ’ç”¢å“æ¼”ç¤º"]
}
```

### æ±ºç­–çµæ§‹ï¼ˆJSONBï¼‰

```json
{
  "decision_maker": "å¼µç¸½ç¶“ç†",
  "influencers": ["IT éƒ¨é–€ä¸»ç®¡", "è²¡å‹™ç¶“ç†"],
  "users": ["æ¥­å‹™éƒ¨é–€å“¡å·¥"]
}
```

### å®¢æˆ¶è³‡è¨Šï¼ˆè‡ªå‹•æå–ï¼‰

- `customer_company`ï¼šå®¢æˆ¶å…¬å¸åç¨±
- `customer_title`ï¼šå®¢æˆ¶è·ç¨±
- `customer_phone`ï¼šå®¢æˆ¶é›»è©±
- `customer_email`ï¼šå®¢æˆ¶é›»å­éƒµä»¶
- `customer_address`ï¼šå®¢æˆ¶åœ°å€

### ç”¢å“è³‡è¨Šï¼ˆè‡ªå‹•æå–ï¼‰

- `product_category`ï¼šç”¢å“é¡åˆ¥
- `product_specs`ï¼šç”¢å“è¦æ ¼

### å ±åƒ¹è³‡è¨Šï¼ˆè‡ªå‹•æå–ï¼‰

- `quote_amount`ï¼šå ±åƒ¹é‡‘é¡ï¼ˆDECIMALï¼‰
- `quote_date`ï¼šå ±åƒ¹æ—¥æœŸï¼ˆDATEï¼‰
- `quote_status`ï¼šå ±åƒ¹ç‹€æ…‹ï¼ˆpending/quoted/negotiating/accepted/rejectedï¼‰

### è©³ç´°å ±å‘Šï¼ˆTEXTï¼‰

Markdown æ ¼å¼çš„å®Œæ•´åˆ†æå ±å‘Šï¼ŒåŒ…å«ï¼š
- å®¢æˆ¶èƒŒæ™¯
- éœ€æ±‚åˆ†æ
- æºé€šæ­·ç¨‹
- æ±ºç­–å› ç´ 
- é¢¨éšªè©•ä¼°
- ç­–ç•¥å»ºè­°

## æ¸¬è©¦æ¡ˆä¾‹

### æ¡ˆä¾‹ 1ï¼šåŸºæœ¬åŠŸèƒ½æ¸¬è©¦

**æ¸¬è©¦ç›®æ¨™**ï¼šé©—è­‰ AI åˆ†æèƒ½å¦æ­£å¸¸åŸ·è¡Œ

1. ä¸Šå‚³åŒ…å« 10-20 ç­†å°è©±çš„ CSV æª”æ¡ˆ
2. ç­‰å¾… 30 ç§’
3. æŸ¥è©¢è³‡æ–™åº«ï¼Œæª¢æŸ¥ `ai_analysis_status` æ˜¯å¦ç‚º `completed`
4. æª¢æŸ¥ 6 å€‹é›·é”åœ–åˆ†æ•¸æ˜¯å¦éƒ½æœ‰å€¼ï¼ˆ0-100ï¼‰

### æ¡ˆä¾‹ 2ï¼šè³‡è¨Šæå–æ¸¬è©¦

**æ¸¬è©¦ç›®æ¨™**ï¼šé©—è­‰ AI èƒ½å¦æ­£ç¢ºæå–å®¢æˆ¶è³‡è¨Š

1. ä¸Šå‚³åŒ…å«å®¢æˆ¶å…¬å¸ã€è·ç¨±ã€é›»è©±ç­‰è³‡è¨Šçš„ CSV
2. æŸ¥è©¢ `customer_company`, `customer_title`, `customer_phone` ç­‰æ¬„ä½
3. é©—è­‰æå–çš„è³‡è¨Šæ˜¯å¦æ­£ç¢º

### æ¡ˆä¾‹ 3ï¼šå ±åƒ¹åˆ†ææ¸¬è©¦

**æ¸¬è©¦ç›®æ¨™**ï¼šé©—è­‰ AI èƒ½å¦è­˜åˆ¥å ±åƒ¹è³‡è¨Š

1. ä¸Šå‚³åŒ…å«å ±åƒ¹é‡‘é¡å’Œæ—¥æœŸçš„å°è©±
2. æŸ¥è©¢ `quote_amount`, `quote_date`, `quote_status`
3. é©—è­‰å ±åƒ¹è³‡è¨Šæ˜¯å¦æ­£ç¢ºæå–

### æ¡ˆä¾‹ 4ï¼šæ±ºç­–çµæ§‹æ¸¬è©¦

**æ¸¬è©¦ç›®æ¨™**ï¼šé©—è­‰ AI èƒ½å¦è­˜åˆ¥æ±ºç­–è€…

1. ä¸Šå‚³æåˆ°æ±ºç­–è€…ã€å½±éŸ¿è€…çš„å°è©±
2. æŸ¥è©¢ `decision_structure` JSONB æ¬„ä½
3. é©—è­‰æ±ºç­–çµæ§‹æ˜¯å¦æ­£ç¢º

## æ•…éšœæ’é™¤

### å•é¡Œ 1ï¼šAI åˆ†æç‹€æ…‹ä¸€ç›´æ˜¯ `processing`

**å¯èƒ½åŸå› **ï¼š
- Gemini API èª¿ç”¨å¤±æ•—
- ç¶²çµ¡é€£æ¥å•é¡Œ
- API é…é¡ç”¨ç›¡

**è§£æ±ºæ–¹æ³•**ï¼š
1. æª¢æŸ¥æ—¥èªŒï¼š`grep "AI åˆ†æå¤±æ•—" /tmp/crm-server.log`
2. æª¢æŸ¥ Gemini API Key æ˜¯å¦æ­£ç¢º
3. æ‰‹å‹•é‡ç½®ç‹€æ…‹ï¼š`UPDATE ci_customers SET ai_analysis_status = 'pending' WHERE customer_id = 'U12345678'`

### å•é¡Œ 2ï¼šé›·é”åœ–åˆ†æ•¸éƒ½æ˜¯ 0

**å¯èƒ½åŸå› **ï¼š
- AI åˆ†æå°šæœªå®Œæˆ
- å°è©±å…§å®¹ä¸è¶³

**è§£æ±ºæ–¹æ³•**ï¼š
1. æª¢æŸ¥ `ai_analysis_status` æ˜¯å¦ç‚º `completed`
2. æª¢æŸ¥å°è©±è¨˜éŒ„æ•¸é‡ï¼š`SELECT COUNT(*) FROM ci_interactions WHERE customer_id = 'U12345678'`
3. ç¢ºä¿å°è©±å…§å®¹æœ‰å¯¦è³ªæ€§è¨è«–

### å•é¡Œ 3ï¼šè³‡æ–™åº«æ¬„ä½ä¸å­˜åœ¨

**å¯èƒ½åŸå› **ï¼š
- è³‡æ–™åº«é·ç§»å°šæœªåŸ·è¡Œ
- PostgreSQL é€£æ¥å¤±æ•—

**è§£æ±ºæ–¹æ³•**ï¼š
1. æª¢æŸ¥ä¼ºæœå™¨æ—¥èªŒæ˜¯å¦æœ‰ã€ŒAI åˆ†ææ¬„ä½å·²æ·»åŠ å®Œæˆã€
2. æ‰‹å‹•åŸ·è¡Œé·ç§»è…³æœ¬ï¼š`node migrate-with-retry.mjs`
3. é‡å•Ÿä¼ºæœå™¨ä»¥è§¸ç™¼è‡ªå‹•é·ç§»

## API ç«¯é»

### æ‰‹å‹•è§¸ç™¼ AI åˆ†æï¼ˆé–‹ç™¼ç”¨ï¼‰

```bash
curl -X POST http://localhost:3000/api/customers/analyze \
  -H "Content-Type: application/json" \
  -d '{"customer_id": "U12345678"}'
```

### æŸ¥è©¢åˆ†æç‹€æ…‹

```bash
curl http://localhost:3000/api/customers/U12345678/analysis-status
```

## æ€§èƒ½æŒ‡æ¨™

- **CSV ä¸Šå‚³æ™‚é–“**ï¼š< 2 ç§’ï¼ˆä¸å« AI åˆ†æï¼‰
- **AI åˆ†ææ™‚é–“**ï¼š10-30 ç§’ï¼ˆç•°æ­¥ï¼‰
- **è³‡æ–™åº«æ›´æ–°æ™‚é–“**ï¼š< 1 ç§’
- **ä½µç™¼è™•ç†èƒ½åŠ›**ï¼šæ”¯æ´å¤šå€‹ CSV åŒæ™‚ä¸Šå‚³

## ä¸‹ä¸€æ­¥é–‹ç™¼

- [ ] å¯¦ç¾åŸºæ–¼éŸ³æª”çš„è¼ªå»“å¢å¼·åŠŸèƒ½
- [ ] å‰ç«¯é¡¯ç¤ºé›·é”åœ–å’Œåˆ†æå ±å‘Š
- [ ] æå–å ±åƒ¹æ•¸å­—ä¸¦è¨ˆç®— V/P è©•åˆ†
- [ ] å„ªåŒ– Gemini åˆ†ææç¤ºè©
- [ ] æ·»åŠ åˆ†æçµæœå¿«å–æ©Ÿåˆ¶

## æŠ€è¡“ç´°ç¯€

### AI åˆ†ææµç¨‹

```
CSV ä¸Šå‚³
  â†“
è§£ææª”æ¡ˆä¸¦å­˜å„²äº’å‹•è¨˜éŒ„
  â†“
æ›´æ–° communication_timeline
  â†“
è§¸ç™¼ generateAIAnalysisAsyncï¼ˆç•°æ­¥ï¼‰
  â†“
æŸ¥è©¢æ‰€æœ‰äº’å‹•è¨˜éŒ„
  â†“
æ§‹å»º Gemini æç¤ºè©
  â†“
èª¿ç”¨ Gemini API
  â†“
è§£æ JSON å›æ‡‰
  â†“
æ›´æ–°è³‡æ–™åº«ï¼ˆ24+ å€‹æ¬„ä½ï¼‰
  â†“
è¨­ç½®ç‹€æ…‹ç‚º completed
```

### éŒ¯èª¤è™•ç†

- **API å¤±æ•—**ï¼šè¨­ç½®ç‹€æ…‹ç‚º `failed`ï¼Œè¨˜éŒ„éŒ¯èª¤æ—¥èªŒ
- **JSON è§£æå¤±æ•—**ï¼šè¿”å›é»˜èªå€¼ï¼ˆåˆ†æ•¸ 50ï¼‰ï¼Œè¨˜éŒ„åŸå§‹å›æ‡‰
- **è³‡æ–™åº«éŒ¯èª¤**ï¼šå›æ»¾äº‹å‹™ï¼Œä¿æŒæ•¸æ“šä¸€è‡´æ€§

### æ—¥èªŒç´šåˆ¥

- `info`ï¼šæ­£å¸¸æµç¨‹ï¼ˆé–‹å§‹åˆ†æã€å®Œæˆåˆ†æï¼‰
- `warn`ï¼šè­¦å‘Šï¼ˆæ²’æœ‰äº’å‹•è¨˜éŒ„ï¼‰
- `error`ï¼šéŒ¯èª¤ï¼ˆAPI å¤±æ•—ã€è§£æå¤±æ•—ï¼‰

## è¯çµ¡è³‡è¨Š

å¦‚æœ‰å•é¡Œï¼Œè«‹æŸ¥çœ‹ï¼š
- ä¼ºæœå™¨æ—¥èªŒï¼š`/tmp/crm-server.log`
- GitHub å€‰åº«ï¼šhttps://github.com/inphic111-ui/basic-crm-online
- æœ€æ–°æäº¤ï¼š78ed071
